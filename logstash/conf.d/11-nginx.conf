filter {
  if [type] == "nginx-access" {
    grok {
      patterns_dir => "/opt/logstash/patterns_extra"
      match => { "message" => "%{NGX_ACCESS_LOG}" }
    }
    date {
      match => ['nginx_timestamp', 'dd/MMM/YYYY:HH:mm:ss Z']
      target => '@timestamp'
    }
    geoip {
      source => "clientip"
    }
  }
}